var j=null;
function n(){function t(){}function u(a){function b(a,c){c.k&&d.push.apply(d,c.k);if(c.id){if(f[c.id])throw Error("Redefinition of state id "+c.id);f[c.id]=c}c.type=c.type||"state";c.n=a;c.depth=a.length;c.parent=a[0];c.k=c.k||[];c.k.forEach(function(a){a.o=i++;a.source=c});var g=b.bind(j,[c].concat(a));c.e&&c.e.forEach(g);switch(c.type){case "parallel":c.c=e.m;break;case "initial":c.c=e.M;break;case "history":c.c=e.u;break;case "final":c.c=e.t;break;case "state":case "scxml":c.c=c.e&&c.e.length?
e.h:e.s;break;default:throw Error("Unknown state type: "+c.type);}c.g=c.e?c.e.concat(c.e.map(function(a){return a.g}).reduce(function(a,b){return a.concat(b)},[])):[];if(c.c===e.h&&("string"===typeof c.ga?(g=c.e.filter(function(a){return a.id===c.ga}),g.length&&(c.H=g[0])):(g=c.e.filter(function(a){return"initial"===a.type}),c.H=g.length?g[0]:c.e[0]),!c.H))throw Error("Unable to locate initial state for composite state: "+c.id);if(c.c===e.h||c.c===e.m)g=c.e.filter(function(a){return"history"===a.type}),
c.G=g[0];if(!c.id){g=c.type;void 0===h[g]&&(h[g]=0);var v=h[g]++;c.id="$generated-"+g+"-"+v;f[c.id]=c}["onEntry","onExit"].forEach(function(a){"function"===typeof c[a]&&(c[a]=[c[a]])})}var d=[],f={},i=0,h={},a={e:[{type:"initial",k:[{target:a}]},a]};b([],a);d.forEach(function(a){"function"===typeof a.j&&(a.j=[a.j])});d.forEach(function(a){a.event&&(a.F=a.event.trim().split(/ +/))});d.forEach(function(a){if(!(a.f||"undefined"===typeof a.target))if("string"===typeof a.target){var b=f[a.target];if(!b)throw Error("Unable to find target state with id "+
a.target);a.target=b;a.f=[a.target]}else if(Array.isArray(a.target))a.f=a.target.map(function(b){if("string"===typeof b&&(b=f[b],!b))throw Error("Unable to find target state with id "+a.target);return b});else if("object"===typeof a.target)a.f=[a.target];else throw Error("Transition target has unknown type: "+a.target);});d.forEach(function(a){if(a.f){var b=a.f[0],d=[];a.source.n.forEach(function(a){a.c===e.h&&-1<a.g.indexOf(b)&&d.push(a)});if(!d.length)throw Error("Could not find LCA for states.");
a.ja=d[0]}var f="internal"===a.type&&a.source.parent&&a.f&&a.f.every(function(b){return-1<a.source.g.indexOf(b)});a.scope=a.f?f?a.source:a.ja:a.source});return a}function o(a){a=a||[];this.b=[];a.forEach(function(a){this.add(a)},this)}function w(a){var b=a[0],a=a[1];return b.source.depth<a.source.depth?a:a.source.depth<b.source.depth?b:b.o<a.o?b:a}function l(a,b){this.C=b.va||(b.InterpreterScriptingContext?new b.InterpreterScriptingContext(this):{});var d;"function"===typeof a?(b.x=b.x||{},d=["x",
"sessionid","name","ioprocessors"].map(function(a){return b.x["_"+a]=b[a]}).concat(this.isIn.bind(this)),d=a.apply(this,d)):d=a;this.na=u(d);this.a=b||{};this.a.console=b.console||("undefined"===typeof console?{log:function(){}}:console);this.a.d=this.a.d||o;this.a.U=this.a.U||w;this.a.V=this.a.V||p;this.C.log=this.C.log||this.a.console.log;this.i=new this.a.d;this.w={};this.z=[];this.$=!1;this.ra={pa:b.Aa||j,oa:d.name||b.name||j,ma:b.wa||j};this.B=[]}function q(a,b){b=b||{};b.InterpreterScriptingContext=
b.InterpreterScriptingContext||r;this.A=!1;this.P=[];l.call(this,a,b)}function r(a){this.la=a;this.qa={}}var e={s:0,h:1,m:2,u:3,M:4,t:5};o.prototype={add:function(a){if(!this.contains(a))return this.b.push(a)},remove:function(a){a=this.b.indexOf(a);if(-1===a)return!1;this.b.splice(a,1);return!0},L:function(a){a=a.T?a.b:a;a.forEach(function(a){this.add(a)},this);return this},R:function(a){a=a.T?a.b:a;a.forEach(function(a){this.remove(a)},this);return this},contains:function(a){return-1<this.b.indexOf(a)},
T:function(){return this.b},p:function(){return!this.b.length},toString:function(){return"Set("+this.b.toString()+")"}};var p,s={};p=function(a,b,d){return a.k.filter(function(a){var e;if(!(e=!a.F))e=b&&b.name&&(-1<a.F.indexOf("*")?!0:a.F.filter(function(a){return(s[a]?s[a]:s[a]=RegExp("^"+a.replace(/\./g,"\\.")+"(\\.[0-9a-zA-Z]+)*$")).test(b.name)}).length);return e&&(!a.ea||d(a.ea))})};var m={l:function(a,b){var d;d=a.n.indexOf(b);return-1<d?a.n.slice(0,d):a.n},S:function(a,b){return[a].concat(this.l(a,
b))},ua:function(a){return[a].concat(a.g)},ia:function(a,b){return!this.ha(a,b)&&this.fa(a,b).c===e.m},ha:function(a,b){return-1<this.S(b).indexOf(a)||-1<this.S(a).indexOf(b)},fa:function(a,b){return this.l(a).filter(function(a){return-1<a.g.indexOf(b)},this)[0]}};l.prototype={aa:function(a){a&&this.z.push(a);for(a=!0;a;)a=this.z.shift()||j,a=!this.ba(a).p();this.$=this.i.b.every(function(a){return a.c===e.t})},ba:function(a){var b=this.da(a);if(!b.p()){var d=new this.a.d(b.b.filter(function(a){return a.f})),
f=this.Y(d),i=f[0],h=f[1],f=this.X(d),d=f[0],f=f[1],k=new this.a.d,c=this.O.bind(this,a);h.forEach(function(a){this.a.ka&&this.a.console.log("exiting ",a.id);this.B.forEach(function(b){b.J&&b.J(a.id)});void 0!==a.J&&a.J.forEach(c);var b;a.G&&(b=a.G.xa?function(b){return b.c===e.s&&-1<a.g.indexOf(b)}:function(b){return b.parent===a},this.w[a.G.id]=h.filter(b))},this);b.b.sort(function(a,b){return a.o-b.o}).forEach(function(a){var b=a.f&&a.f.map(function(a){return a.id});this.B.forEach(function(c){c.j&&
c.j(a.source.id,b)});void 0!==a.j&&a.j.forEach(c)},this);f.forEach(function(a){this.a.ka&&this.a.console.log("entering",a.id);this.B.forEach(function(b){b.I&&b.I(a.id)});void 0!==a.I&&a.I.forEach(c)},this);this.i.R(i);this.i.L(d);k.p()||this.z.push(k)}return b},O:function(a,b){return b.call(this.C,a)},Y:function(a){var b=new this.a.d,d=new this.a.d;a.b.forEach(function(a){var e=a.scope,h=e.g;this.i.b.forEach(function(a){-1<h.indexOf(a)&&(d.add(a),b.add(a),m.l(a,e).forEach(function(a){b.add(a)}))},
this)},this);a=b.b.sort(function(a,b){return b.depth-a.depth});return[d,a]},X:function(a){var b={q:new this.a.d,D:new this.a.d,K:new this.a.d,r:[]};for(a.b.forEach(function(a){a.f.forEach(function(f){this.N(f,a.scope,b)},this)},this);a=b.r.pop();)this.v(a,b);a=b.q.b.sort(function(a,b){return a.depth-b.depth});return[b.D,a]},N:function(a,b,d){this.v(a,d);m.l(a,b).forEach(function(a){a.c===e.h?(d.q.add(a),d.K.add(a)):this.v(a,d)},this)},v:function(a,b){b.K.contains(a)||(a.c===e.u?a.id in this.w?this.w[a.id].forEach(function(d){this.N(d,
a.parent,b)},this):(b.q.add(a),b.D.add(a)):(b.q.add(a),a.c===e.m?b.r.push.apply(b.r,a.e.filter(function(a){return a.c!==e.u})):a.c===e.h?b.r.push(a.H):(a.c===e.M||a.c===e.s||a.c===e.t)&&b.D.add(a)),b.K.add(a))},da:function(a){if(this.a.ya)var b=this.i.b;else{var d=new this.a.d;this.i.b.forEach(function(a){d.add(a);m.l(a).forEach(function(a){d.add(a)})},this);b=d.b}var e=a&&a.name&&a.name.search(".")?p:this.a.V,i=new this.a.d,h=this.O.bind(this,a);b.forEach(function(b){e(b,a,h).forEach(function(a){i.add(a)})});
return this.ca(i)},ca:function(a){var b=new this.a.d,d=this.Q(a),a=d[0],d=d[1];for(b.L(a);!d.p();)a=new this.a.d(d.b.map(function(a){return this.a.U(a)},this)),d=this.Q(a),a=d[0],d=d[1],b.L(a);return b},Q:function(a){for(var b=new this.a.d,d=new this.a.d,e=a.b,i=0;i<e.length;i++)for(var h=i+1;h<e.length;h++){var k=e[i],c=e[h];this.W(k,c)&&(b.add(k),b.add(c),d.add([k,c]))}return[a.R(b),d]},W:function(a,b){return!this.Z(a,b)},Z:function(a,b){return m.ia(a.scope,b.scope)}};t.prototype=l.prototype;q.prototype=
new t;q.prototype.gen=function(a,b){var d;switch(typeof a){case "string":d={name:a,data:b};break;case "object":if("string"===typeof a.name)d=a;else throw Error('Event object must have "name" property of type string.');break;default:throw Error("First argument to gen must be a string or object.");}this.P.push(d);if(this.A)return j;for(this.A=!0;d=this.P.shift();)this.aa(d);this.A=!1;return this.getConfiguration()};r.prototype={};return{BaseInterpreter:l,Statechart:q,ArraySet:o,STATE_TYPES:e,initializeModel:u,
InterpreterScriptingContext:r}}"object"===typeof exports?module.ta=n():"function"===typeof define&&define.sa?define(n):this.za=n();
