var j=null;
function n(){function t(){}function u(a){function b(a,d){d.k&&c.push.apply(c,d.k);if(d.id){if(f[d.id])throw Error("Redefinition of state id "+d.id);f[d.id]=d}d.type=d.type||"state";d.n=a;d.depth=a.length;d.parent=a[0];d.k=d.k||[];d.k.forEach(function(a){a.o=i++;a.source=d});var g=b.bind(j,[d].concat(a));d.e&&d.e.forEach(g);switch(d.type){case "parallel":d.c=e.m;break;case "initial":d.c=e.M;break;case "history":d.c=e.u;break;case "final":d.c=e.t;break;case "state":case "scxml":d.c=d.e&&d.e.length?
e.h:e.s;break;default:throw Error("Unknown state type: "+d.type);}d.g=d.e?d.e.concat(d.e.map(function(a){return a.g}).reduce(function(a,b){return a.concat(b)},[])):[];if(d.c===e.h&&("string"===typeof d.ga?(g=d.e.filter(function(a){return a.id===d.ga}),g.length&&(d.H=g[0])):(g=d.e.filter(function(a){return"initial"===a.type}),d.H=g.length?g[0]:d.e[0]),!d.H))throw Error("Unable to locate initial state for composite state: "+d.id);if(d.c===e.h||d.c===e.m)g=d.e.filter(function(a){return"history"===a.type}),
d.G=g[0];if(!d.id){g=d.type;void 0===h[g]&&(h[g]=0);var v=h[g]++;d.id="$generated-"+g+"-"+v;f[d.id]=d}["onEntry","onExit"].forEach(function(a){"function"===typeof d[a]&&(d[a]=[d[a]])})}var c=[],f={},i=0,h={},a={e:[{type:"initial",k:[{target:a}]},a]};b([],a);c.forEach(function(a){"function"===typeof a.j&&(a.j=[a.j])});c.forEach(function(a){a.event&&(a.F=a.event.trim().split(/ +/))});c.forEach(function(a){if(!(a.f||"undefined"===typeof a.target))if("string"===typeof a.target){var b=f[a.target];if(!b)throw Error("Unable to find target state with id "+
a.target);a.target=b;a.f=[a.target]}else if(Array.isArray(a.target))a.f=a.target.map(function(b){if("string"===typeof b&&(b=f[b],!b))throw Error("Unable to find target state with id "+a.target);return b});else if("object"===typeof a.target)a.f=[a.target];else throw Error("Transition target has unknown type: "+a.target);});c.forEach(function(a){if(a.f){var b=a.f[0],c=[];a.source.n.forEach(function(a){a.c===e.h&&-1<a.g.indexOf(b)&&c.push(a)});if(!c.length)throw Error("Could not find LCA for states.");
a.ja=c[0]}var f="internal"===a.type&&a.source.parent&&a.f&&a.f.every(function(b){return-1<a.source.g.indexOf(b)});a.scope=a.f?f?a.source:a.ja:a.source});return a}function o(a){a=a||[];this.b=[];a.forEach(function(a){this.add(a)},this)}function w(a){var b=a[0],a=a[1];return b.source.depth<a.source.depth?a:a.source.depth<b.source.depth?b:b.o<a.o?b:a}function l(a,b){this.C=b.wa||(b.InterpreterScriptingContext?new b.InterpreterScriptingContext(this):{});var c;"function"===typeof a?(b.x=b.x||{},c=["x",
"sessionid","name","ioprocessors"].map(function(a){return b.x["_"+a]=b[a]}).concat(this.isIn.bind(this)),console.log("args",c),c=a.apply(this,c)):c=a;this.oa=u(c);this.a=b||{};this.a.console=b.console||("undefined"===typeof console?{log:function(){}}:console);this.a.d=this.a.d||o;this.a.U=this.a.U||w;this.a.V=this.a.V||p;this.C.log=this.C.log||this.a.console.log;this.i=new this.a.d;this.w={};this.z=[];this.$=!1;this.sa={qa:b.Aa||j,pa:c.name||b.name||j,na:b.xa||j};this.B=[]}function q(a,b){b=b||{};
b.InterpreterScriptingContext=b.InterpreterScriptingContext||r;this.A=!1;this.P=[];l.call(this,a,b)}function r(a){this.ma=a;this.ra={}}var e={s:0,h:1,m:2,u:3,M:4,t:5};o.prototype={add:function(a){if(!this.contains(a))return this.b.push(a)},remove:function(a){a=this.b.indexOf(a);if(-1===a)return!1;this.b.splice(a,1);return!0},L:function(a){a=a.T?a.b:a;a.forEach(function(a){this.add(a)},this);return this},R:function(a){a=a.T?a.b:a;a.forEach(function(a){this.remove(a)},this);return this},contains:function(a){return-1<
this.b.indexOf(a)},T:function(){return this.b},p:function(){return!this.b.length},toString:function(){return"Set("+this.b.toString()+")"}};var p,s={};p=function(a,b,c){return a.k.filter(function(a){var e;if(!(e=!a.F))e=b&&b.name&&(-1<a.F.indexOf("*")?!0:a.F.filter(function(a){return(s[a]?s[a]:s[a]=RegExp("^"+a.replace(/\./g,"\\.")+"(\\.[0-9a-zA-Z]+)*$")).test(b.name)}).length);return e&&(!a.ea||c(a.ea))})};var m={l:function(a,b){var c;c=a.n.indexOf(b);return-1<c?a.n.slice(0,c):a.n},S:function(a,b){return[a].concat(this.l(a,
b))},va:function(a){return[a].concat(a.g)},ia:function(a,b){return!this.ha(a,b)&&this.fa(a,b).c===e.m},ha:function(a,b){return-1<this.S(b).indexOf(a)||-1<this.S(a).indexOf(b)},fa:function(a,b){return this.l(a).filter(function(a){return-1<a.g.indexOf(b)},this)[0]}};l.prototype={aa:function(a){a&&this.z.push(a);for(a=!0;a;)a=this.z.shift()||j,a=!this.ba(a).p();this.$=this.i.b.every(function(a){return a.c===e.t})},ba:function(a){var b=this.da(a);if(!b.p()){var c=new this.a.d(b.b.filter(function(a){return a.f})),
f=this.Y(c),i=f[0],h=f[1],f=this.X(c),c=f[0],f=f[1],k=new this.a.d,d=this.O.bind(this,a);h.forEach(function(a){this.a.ka&&this.a.console.log("exiting ",a.id);this.B.forEach(function(b){b.J&&b.J(a.id)});void 0!==a.J&&a.J.forEach(d);var b;a.G&&(b=a.G.ya?function(b){return b.c===e.s&&-1<a.g.indexOf(b)}:function(b){return b.parent===a},this.w[a.G.id]=h.filter(b))},this);b.b.sort(function(a,b){return a.o-b.o}).forEach(function(a){var b=a.f&&a.f.map(function(a){return a.id});this.B.forEach(function(c){c.j&&
c.j(a.source.id,b)});void 0!==a.j&&a.j.forEach(d)},this);f.forEach(function(a){this.a.ka&&this.a.console.log("entering",a.id);this.B.forEach(function(b){b.I&&b.I(a.id)});void 0!==a.I&&a.I.forEach(d)},this);this.i.R(i);this.i.L(c);k.p()||this.z.push(k)}return b},O:function(a,b){return b.call(this.C,a)},Y:function(a){var b=new this.a.d,c=new this.a.d;a.b.forEach(function(a){var e=a.scope,h=e.g;this.i.b.forEach(function(a){-1<h.indexOf(a)&&(c.add(a),b.add(a),m.l(a,e).forEach(function(a){b.add(a)}))},
this)},this);a=b.b.sort(function(a,b){return b.depth-a.depth});return[c,a]},X:function(a){var b={q:new this.a.d,D:new this.a.d,K:new this.a.d,r:[]};for(a.b.forEach(function(a){a.f.forEach(function(f){this.N(f,a.scope,b)},this)},this);a=b.r.pop();)this.v(a,b);a=b.q.b.sort(function(a,b){return a.depth-b.depth});return[b.D,a]},N:function(a,b,c){this.v(a,c);m.l(a,b).forEach(function(a){a.c===e.h?(c.q.add(a),c.K.add(a)):this.v(a,c)},this)},v:function(a,b){b.K.contains(a)||(a.c===e.u?a.id in this.w?this.w[a.id].forEach(function(c){this.N(c,
a.parent,b)},this):(b.q.add(a),b.D.add(a)):(b.q.add(a),a.c===e.m?b.r.push.apply(b.r,a.e.filter(function(a){return a.c!==e.u})):a.c===e.h?b.r.push(a.H):(a.c===e.M||a.c===e.s||a.c===e.t)&&b.D.add(a)),b.K.add(a))},da:function(a){if(this.a.za)var b=this.i.b;else{var c=new this.a.d;this.i.b.forEach(function(a){c.add(a);m.l(a).forEach(function(a){c.add(a)})},this);b=c.b}var e=a&&a.name&&a.name.search(".")?p:this.a.V,i=new this.a.d,h=this.O.bind(this,a);b.forEach(function(b){e(b,a,h).forEach(function(a){i.add(a)})});
return this.ca(i)},ca:function(a){var b=new this.a.d,c=this.Q(a),a=c[0],c=c[1];for(b.L(a);!c.p();)a=new this.a.d(c.b.map(function(a){return this.a.U(a)},this)),c=this.Q(a),a=c[0],c=c[1],b.L(a);return b},Q:function(a){for(var b=new this.a.d,c=new this.a.d,e=a.b,i=0;i<e.length;i++)for(var h=i+1;h<e.length;h++){var k=e[i],d=e[h];this.W(k,d)&&(b.add(k),b.add(d),c.add([k,d]))}return[a.R(b),c]},W:function(a,b){return!this.Z(a,b)},Z:function(a,b){return m.ia(a.scope,b.scope)}};t.prototype=l.prototype;q.prototype=
new t;q.prototype.gen=function(a,b){var c;switch(typeof a){case "string":c={name:a,data:b};break;case "object":if("string"===typeof a.name)c=a;else throw Error('Event object must have "name" property of type string.');break;default:throw Error("First argument to gen must be a string or object.");}this.P.push(c);if(this.A)return j;for(this.A=!0;c=this.P.shift();)this.aa(c);this.A=!1;return this.getConfiguration()};r.prototype={};return{BaseInterpreter:l,Statechart:q,ArraySet:o,STATE_TYPES:e,initializeModel:u,
InterpreterScriptingContext:r}}"object"===typeof exports?module.ua=n():"function"===typeof define&&define.ta?define(n):this.la=n();
