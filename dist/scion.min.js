var j=null;
function n(){function t(){}function u(a){function b(a,c){c.k&&d.push.apply(d,c.k);if(c.id){if(f[c.id])throw Error("Redefinition of state id "+c.id);f[c.id]=c}c.type=c.type||"state";c.o=a;c.depth=a.length;c.parent=a[0];c.k=c.k||[];c.k.forEach(function(a){a.p=i++;a.source=c});var g=b.bind(j,[c].concat(a));c.e&&c.e.forEach(g);switch(c.type){case "parallel":c.c=e.m;break;case "initial":c.c=e.M;break;case "history":c.c=e.v;break;case "final":c.c=e.u;break;case "state":case "scxml":c.c=c.e&&c.e.length?
e.h:e.t;break;default:throw Error("Unknown state type: "+c.type);}c.g=c.e?c.e.concat(c.e.map(function(a){return a.g}).reduce(function(a,b){return a.concat(b)},[])):[];if(c.c===e.h&&("string"===typeof c.ka?(g=c.e.filter(function(a){return a.id===c.ka}),g.length&&(c.H=g[0])):(g=c.e.filter(function(a){return"initial"===a.type}),c.H=g.length?g[0]:c.e[0]),!c.H))throw Error("Unable to locate initial state for composite state: "+c.id);if(c.c===e.h||c.c===e.m)g=c.e.filter(function(a){return"history"===a.type}),
c.G=g[0];if(!c.id){g=c.type;void 0===h[g]&&(h[g]=0);var v=h[g]++;c.id="$generated-"+g+"-"+v;f[c.id]=c}["onEntry","onExit"].forEach(function(a){"function"===typeof c[a]&&(c[a]=[c[a]])})}var d=[],f={},i=0,h={},a={e:[{type:"initial",k:[{target:a}]},a]};b([],a);d.forEach(function(a){"function"===typeof a.j&&(a.j=[a.j])});d.forEach(function(a){a.event&&(a.F=a.event.trim().split(/ +/))});d.forEach(function(a){if(!(a.f||"undefined"===typeof a.target))if("string"===typeof a.target){var b=f[a.target];if(!b)throw Error("Unable to find target state with id "+
a.target);a.target=b;a.f=[a.target]}else if(Array.isArray(a.target))a.f=a.target.map(function(b){if("string"===typeof b&&(b=f[b],!b))throw Error("Unable to find target state with id "+a.target);return b});else if("object"===typeof a.target)a.f=[a.target];else throw Error("Transition target has unknown type: "+a.target);});d.forEach(function(a){if(a.f){var b=a.f[0],d=[];a.source.o.forEach(function(a){a.c===e.h&&-1<a.g.indexOf(b)&&d.push(a)});if(!d.length)throw Error("Could not find LCA for states.");
a.na=d[0]}var f="internal"===a.type&&a.source.parent&&a.f&&a.f.every(function(b){return-1<a.source.g.indexOf(b)});a.scope=a.f?f?a.source:a.na:a.source});return a}function o(a){a=a||[];this.b=[];a.forEach(function(a){this.add(a)},this)}function w(a){var b=a[0],a=a[1];return b.source.depth<a.source.depth?a:a.source.depth<b.source.depth?b:b.p<a.p?b:a}function l(a,b){this.ra=u(a);this.a=b||{};this.a.console=b.console||("undefined"===typeof console?{log:function(){}}:console);this.a.d=this.a.d||o;this.a.U=
this.a.U||w;this.a.V=this.a.V||p;this.sa=this.a.Ba||"";this.i=new this.a.d;this.z={};this.A=[];this.aa=!1;this.n={ha:b.Aa||j,ba:a.name||b.name||j,Z:b.xa||j};this.C=[];b.InterpreterScriptingContext||b.log("Warning : interpreter scripting context not set");this.ea=b.InterpreterScriptingContext?new b.InterpreterScriptingContext(this):{}}function q(a,b){b=b||{};b.InterpreterScriptingContext=b.InterpreterScriptingContext||r;this.B=!1;this.P=[];l.call(this,a,b)}function r(a){this.qa=a;this.ta={}}var e=
{t:0,h:1,m:2,v:3,M:4,u:5};o.prototype={add:function(a){if(!this.contains(a))return this.b.push(a)},remove:function(a){a=this.b.indexOf(a);if(-1===a)return!1;this.b.splice(a,1);return!0},L:function(a){a=a.T?a.b:a;a.forEach(function(a){this.add(a)},this);return this},R:function(a){a=a.T?a.b:a;a.forEach(function(a){this.remove(a)},this);return this},contains:function(a){return-1<this.b.indexOf(a)},T:function(){return this.b},q:function(){return!this.b.length},toString:function(){return"Set("+this.b.toString()+
")"}};var p,s={};p=function(a,b,d){return a.k.filter(function(a){var e;if(!(e=!a.F))e=b&&b.name&&(-1<a.F.indexOf("*")?!0:a.F.filter(function(a){return(s[a]?s[a]:s[a]=RegExp("^"+a.replace(/\./g,"\\.")+"(\\.[0-9a-zA-Z]+)*$")).test(b.name)}).length);return e&&(!a.ia||d(a.ia))})};var m={l:function(a,b){var d;d=a.o.indexOf(b);return-1<d?a.o.slice(0,d):a.o},S:function(a,b){return[a].concat(this.l(a,b))},wa:function(a){return[a].concat(a.g)},ma:function(a,b){return!this.la(a,b)&&this.ja(a,b).c===e.m},la:function(a,
b){return-1<this.S(b).indexOf(a)||-1<this.S(a).indexOf(b)},ja:function(a,b){return this.l(a).filter(function(a){return-1<a.g.indexOf(b)},this)[0]}};l.prototype={ca:function(a){a&&this.A.push(a);for(a=!0;a;)a=this.A.shift()||j,a=!this.da(a).q();this.aa=this.i.b.every(function(a){return a.c===e.u})},da:function(a){var b=this.ga(a);if(!b.q()){var d=new this.a.d(b.b.filter(function(a){return a.f})),f=this.Y(d),i=f[0],h=f[1],f=this.X(d),d=f[0],f=f[1],k=new this.a.d,c=this.O.bind(this,a);h.forEach(function(a){this.a.oa&&
this.a.console.log("exiting ",a.id);this.C.forEach(function(b){b.J&&b.J(a.id)});void 0!==a.J&&a.J.forEach(c);var b;a.G&&(b=a.G.ya?function(b){return b.c===e.t&&-1<a.g.indexOf(b)}:function(b){return b.parent===a},this.z[a.G.id]=h.filter(b))},this);b.b.sort(function(a,b){return a.p-b.p}).forEach(function(a){var b=a.f&&a.f.map(function(a){return a.id});this.C.forEach(function(c){c.j&&c.j(a.source.id,b)});void 0!==a.j&&a.j.forEach(c)},this);f.forEach(function(a){this.a.oa&&this.a.console.log("entering",
a.id);this.C.forEach(function(b){b.I&&b.I(a.id)});void 0!==a.I&&a.I.forEach(c)},this);this.i.R(i);this.i.L(d);k.q()||this.A.push(k)}return b},O:function(a,b){return b.call(this.ea,a,this.isIn.bind(this),this.n.ha,this.n.ba,this.n.Z,this.n)},Y:function(a){var b=new this.a.d,d=new this.a.d;a.b.forEach(function(a){var e=a.scope,h=e.g;this.i.b.forEach(function(a){-1<h.indexOf(a)&&(d.add(a),b.add(a),m.l(a,e).forEach(function(a){b.add(a)}))},this)},this);a=b.b.sort(function(a,b){return b.depth-a.depth});
return[d,a]},X:function(a){var b={r:new this.a.d,D:new this.a.d,K:new this.a.d,s:[]};for(a.b.forEach(function(a){a.f.forEach(function(f){this.N(f,a.scope,b)},this)},this);a=b.s.pop();)this.w(a,b);a=b.r.b.sort(function(a,b){return a.depth-b.depth});return[b.D,a]},N:function(a,b,d){this.w(a,d);m.l(a,b).forEach(function(a){a.c===e.h?(d.r.add(a),d.K.add(a)):this.w(a,d)},this)},w:function(a,b){b.K.contains(a)||(a.c===e.v?a.id in this.z?this.z[a.id].forEach(function(d){this.N(d,a.parent,b)},this):(b.r.add(a),
b.D.add(a)):(b.r.add(a),a.c===e.m?b.s.push.apply(b.s,a.e.filter(function(a){return a.c!==e.v})):a.c===e.h?b.s.push(a.H):(a.c===e.M||a.c===e.t||a.c===e.u)&&b.D.add(a)),b.K.add(a))},ga:function(a){if(this.a.za)var b=this.i.b;else{var d=new this.a.d;this.i.b.forEach(function(a){d.add(a);m.l(a).forEach(function(a){d.add(a)})},this);b=d.b}var e=a&&a.name&&a.name.search(".")?p:this.a.V,i=new this.a.d,h=this.O.bind(this,a);b.forEach(function(b){e(b,a,h).forEach(function(a){i.add(a)})});return this.fa(i)},
fa:function(a){var b=new this.a.d,d=this.Q(a),a=d[0],d=d[1];for(b.L(a);!d.q();)a=new this.a.d(d.b.map(function(a){return this.a.U(a)},this)),d=this.Q(a),a=d[0],d=d[1],b.L(a);return b},Q:function(a){for(var b=new this.a.d,d=new this.a.d,e=a.b,i=0;i<e.length;i++)for(var h=i+1;h<e.length;h++){var k=e[i],c=e[h];this.W(k,c)&&(b.add(k),b.add(c),d.add([k,c]))}return[a.R(b),d]},W:function(a,b){return!this.$(a,b)},$:function(a,b){return m.ma(a.scope,b.scope)}};t.prototype=l.prototype;q.prototype=new t;q.prototype.gen=
function(a,b){var d;switch(typeof a){case "string":d={name:a,data:b};break;case "object":if("string"===typeof a.name)d=a;else throw Error('Event object must have "name" property of type string.');break;default:throw Error("First argument to gen must be a string or object.");}this.P.push(d);if(this.B)return j;for(this.B=!0;d=this.P.shift();)this.ca(d);this.B=!1;return this.getConfiguration()};r.prototype={};return{BaseInterpreter:l,Statechart:q,ArraySet:o,STATE_TYPES:e,initializeModel:u,InterpreterScriptingContext:r}}
"object"===typeof exports?module.va=n():"function"===typeof define&&define.ua?define(n):this.pa=n();
